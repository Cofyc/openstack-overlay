diff -urN nova-2012.2.2.orig/nova/virt/firewall.py nova-2012.2.2/nova/virt/firewall.py
--- nova-2012.2.2.orig/nova/virt/firewall.py	2013-03-14 13:32:35.073353412 +0100
+++ nova-2012.2.2/nova/virt/firewall.py	2013-03-15 10:21:05.588855190 +0100
@@ -246,18 +246,21 @@
         return 'inst-%s' % (instance['id'],)
 
     def _do_basic_rules(self, ipv4_rules, ipv6_rules, network_info):
+        # Allow established connections
+        ipv4_rules += ['-m state --state ESTABLISHED,RELATED,UNTRACKED -j ACCEPT']
+        ipv6_rules += ['-m state --state ESTABLISHED,RELATED,UNTRACKED -j ACCEPT']
+
         # Always drop invalid packets
         ipv4_rules += ['-m state --state ' 'INVALID -j DROP']
         ipv6_rules += ['-m state --state ' 'INVALID -j DROP']
 
-        # Allow established connections
-        ipv4_rules += ['-m state --state ESTABLISHED,RELATED -j ACCEPT']
-        ipv6_rules += ['-m state --state ESTABLISHED,RELATED -j ACCEPT']
-
         # Pass through provider-wide drops
         ipv4_rules += ['-j $provider']
         ipv6_rules += ['-j $provider']
 
+        # Allow access to metadata server
+        ipv4_rules += ['-s 169.254.169.254/32 -p tcp -m tcp --sport 80 -j ACCEPT']
+
     def _do_dhcp_rules(self, ipv4_rules, network_info):
         # make sure this is legacy nw_info
         network_info = self._handle_network_info_model(network_info)
